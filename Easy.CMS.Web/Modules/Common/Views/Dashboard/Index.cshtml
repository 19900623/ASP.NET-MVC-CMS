@{
    Script.Reqiured("Chart").AtHead();
}
@using Easy.CMS.Common
@using Newtonsoft.Json
@model Easy.CMS.Common.ViewModels.DashboardViewModel
<script type="text/javascript">
    var backgroundColor = [
        "rgba(255, 99, 132, 0.2)",
        "rgba(54, 162, 235, 0.2)",
        "rgba(255, 206, 86, 0.2)",
        "rgba(75, 192, 192, 0.2)",
        "rgba(153, 102, 255, 0.2)",
        "rgba(255, 159, 64, 0.2)",
        "rgba(255, 99, 132, 0.2)",
        "rgba(54, 162, 235, 0.2)",
        "rgba(255, 206, 86, 0.2)",
        "rgba(75, 192, 192, 0.2)",
        "rgba(153, 102, 255, 0.2)",
        "rgba(255, 159, 64, 0.2)",
        "rgba(255, 99, 132, 0.2)",
        "rgba(54, 162, 235, 0.2)",
        "rgba(255, 206, 86, 0.2)",
        "rgba(75, 192, 192, 0.2)",
        "rgba(153, 102, 255, 0.2)",
        "rgba(255, 159, 64, 0.2)",
        "rgba(255, 99, 132, 0.2)",
        "rgba(54, 162, 235, 0.2)",
        "rgba(255, 206, 86, 0.2)",
        "rgba(75, 192, 192, 0.2)",
        "rgba(153, 102, 255, 0.2)",
        "rgba(255, 159, 64, 0.2)"
    ];
    var borderColor = [
        "rgba(255,99,132,1)",
        "rgba(54, 162, 235, 1)",
        "rgba(255, 206, 86, 1)",
        "rgba(75, 192, 192, 1)",
        "rgba(153, 102, 255, 1)",
        "rgba(255, 159, 64, 1)",
        "rgba(255,99,132,1)",
        "rgba(54, 162, 235, 1)",
        "rgba(255, 206, 86, 1)",
        "rgba(75, 192, 192, 1)",
        "rgba(153, 102, 255, 1)",
        "rgba(255, 159, 64, 1)",
        "rgba(255,99,132,1)",
        "rgba(54, 162, 235, 1)",
        "rgba(255, 206, 86, 1)",
        "rgba(75, 192, 192, 1)",
        "rgba(153, 102, 255, 1)",
        "rgba(255, 159, 64, 1)",
        "rgba(255,99,132,1)",
        "rgba(54, 162, 235, 1)",
        "rgba(255, 206, 86, 1)",
        "rgba(75, 192, 192, 1)",
        "rgba(153, 102, 255, 1)",
        "rgba(255, 159, 64, 1)"
    ];
</script>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">欢迎</div>
                <div class="panel-body">
                    <h2>
                        欢迎使用ZKEACMS
                    </h2>
                    <p class="text-muted">
                        <small>我们准备了几个链接供您开始：</small>
                    </p>
                    @if (Authorizer.Authorize(PermissionKeys.ManagePage))
                    {
                        <a class="btn btn-primary" href="@Url.Action("Create", "Page", new {module = "admin", ParentID = "#"})">创建页面</a>
                    }
                    @if (Authorizer.Authorize(PermissionKeys.ViewPage))
                    {
                        <a class="btn btn-primary" href="@Url.Action("Index", "Page", new {module = "admin", ParentID = "#"})">查看页面</a>
                    }
                    @if (Authorizer.Authorize(PermissionKeys.ManageLayout))
                    {
                        <a class="btn btn-primary" href="@Url.Action("Create", "Layout", new {module = "admin"})">创建布局</a>
                    }
                    @if (Authorizer.Authorize(PermissionKeys.ViewLayout))
                    {
                        <a class="btn btn-primary" href="@Url.Action("Index", "Layout", new {module = "admin"})">查看布局</a>
                    }
                    @if (Authorizer.Authorize(PermissionKeys.ViewNavigation))
                    {
                        <a class="btn btn-primary" href="@Url.Action("Index", "Navigation", new {module = "admin"})">查看导航</a>
                    }
                </div>
            </div>
        </div>
    </div>
    @{
        foreach (var chart in Model.Charts.Where(m => m.IsFullRow))
        {
            var chartId = Guid.NewGuid().ToString("N");
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">@chart.Title</div>
                        <div class="panel-body">
                            <canvas id="@chartId" height="80"></canvas>
                            @using (Script.AtFoot())
                            {
                                <script>
                                    $(function() {
                                        var chart= new Chart(document.getElementById("@chartId"),@(Html.Raw(JsonConvert.SerializeObject(chart.Option))));
                                    });
                                </script>
                            }
                            
                        </div>
                    </div>
                </div>
            </div>
        }
    }

    <div class="row">
        @{
            foreach (var chart in Model.Charts.Where(m => !m.IsFullRow))
            {
                var chartId = Guid.NewGuid().ToString("N");
                <div class="col-md-@chart.Column">
                    <div class="panel panel-default">
                        <div class="panel-heading">@chart.Title</div>
                        <div class="panel-body">
                            <canvas id="@chartId" height="80"></canvas>
                            @using (Script.AtFoot())
                            {
                                <script>
                                    $(function() {
                                        var chart= new Chart(document.getElementById("@chartId"),@(Html.Raw(JsonConvert.SerializeObject(chart.Option))));
                                    });
                                </script>
                            }
                        </div>
                    </div>
                </div>

            }
        }
    </div>

    
    <div class="row">
        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">24小时访问 Top 10</div>
                <ul class="list-group">
                    @foreach (var page in Model.CurrentTop)
                    {
                        <li class="list-group-item clearfix">
                            <a target="_blank" href="@Url.PathContent(page.PageUrl)" title="@page.PageUrl">@page.PageTitle</a>
                            <br />
                            <small class="text-muted">@page.PageUrl</small>
                            <span class="badge">@page.Sum</span>
                        </li>
                    }
                </ul>
            </div>
        </div>

        <div class="col-md-4">
            <div class="panel panel-default">
                <div class="panel-heading">概览</div>
                <ul class="list-group">
                    <li class="list-group-item">
                        <a href="@Url.Action("Index","Page",new{module="admin"})">页面总数</a>
                        <span class="badge">@Model.Pages</span>
                    </li>
                    <li class="list-group-item">
                        产品总数
                        <span class="badge">@Model.Products</span>
                    </li>
                    <li class="list-group-item">
                        文章总数
                        <span class="badge">@Model.Articles</span>
                    </li>
                    <li class="list-group-item">
                        媒体总数
                        <span class="badge">@Model.Medias</span>
                    </li>
                </ul>
            </div>

        </div>

        <div class="col-md-4">

            @if (Authorizer.Authorize(PermissionKeys.ManagePage))
            {
                <div class="panel panel-default">
                    <div class="panel-heading">已修改/未发布页面</div>
                    <ul class="list-group">
                        @foreach (var page in Model.UnPublishPage)
                        {
                            <li class="list-group-item clearfix">
                                <a target="_blank" href="@Url.Action("Design", "Page", new {module = "admin", ID = page.ID})">@page.PageName</a>
                                <span class="badge">
                                    @page.LastUpdateByName
                                    于
                                    @((DateTime.Now - (page.LastUpdateDate ?? DateTime.Now)).Days)
                                    天前修改
                                </span>
                            </li>
                        }
                    </ul>
                </div>
            }
        </div>
    </div>

</div>
